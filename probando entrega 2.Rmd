---
title: "Probando entrega"
output: html_document
date: "2025-01-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
# Definir la ruta del archivo
adult_data_path <- "C:\\Users\\riosl\\Desktop\\adult.data"

# Nombres de las columnas
column_names <- c('age', 'workclass', 'fnlwgt', 'education', 'education_num', 'marital_status', 'occupation', 'relationship', 'race', 'sex', 'capital_gain', 'capital_loss', 'hours_per_week', 'native_country', 'income')

# Leer el archivo adult.data como un DataFrame
adult_data <- read.csv(adult_data_path, header = FALSE, sep = ',', strip.white = TRUE, col.names = column_names, na.strings = c("?", "NA", ""))

# Mostrar las primeras líneas del archivo para inspección
print(head(adult_data))

# Mostrar las dimensiones del DataFrame
print(dim(adult_data))

```

```{r}
# Identificar valores perdidos
colSums(is.na(adult_data))
```

```{r}
adult_data <- adult_data %>% mutate(
  workclass = ifelse(is.na(workclass), "Unknown", workclass),
  occupation = ifelse(is.na(occupation), "Unknown", occupation),
  native_country = ifelse(is.na(native_country), "Unknown", native_country)
)
```

```{r}
colSums(is.na(adult_data))
```

```{r}
# Ver los tipos de datos de cada columna
sapply(adult_data, class)
```

```{r}
#Transformamos las variables categoricas a factor
adult_data$workclass <- as.factor(adult_data$workclass)
adult_data$education <- as.factor(adult_data$education)
adult_data$marital_status <- as.factor(adult_data$marital_status)
adult_data$occupation <- as.factor(adult_data$occupation)
adult_data$relationship <- as.factor(adult_data$relationship)
adult_data$race <- as.factor(adult_data$race)
adult_data$sex <- as.factor(adult_data$sex)
adult_data$native_country <- as.factor(adult_data$native_country)
adult_data$income <- as.factor(adult_data$income)
```

```{r}
initial_rows <- nrow(adult_data)
```

```{r}
# 3.3.1. Edad (age)
# Mantener valores realistas y eliminar valores imposibles
adult_data <- adult_data %>% filter(age <= 100)

# 3.3.2. Ponderación muestral (fnlwgt)
# Mantener todos los valores ya que representan ponderaciones válidas
cat("Nota: No se eliminan outliers en fnlwgt, ya que son ponderaciones válidas.\n")

# 3.3.3. Años de educación (education_num)
# Mantener valores entre 1 y 20
adult_data <- adult_data %>% filter(education_num <= 20)

# 3.3.4. Ganancia de capital (capital_gain) y Pérdida de capital (capital_loss)
# Mantener todos los valores ya que son válidos en su contexto económico
cat("Nota: No se eliminan outliers en capital_gain ni capital_loss, ya que representan valores económicos válidos.\n")

# 3.3.5. Horas trabajadas por semana (hours_per_week)
# Eliminar valores imposibles  > 100 horas)
adult_data <- adult_data %>% filter(hours_per_week <= 100)
```

```{r}
# Mostrar los boxplots después de la limpieza
par(mfrow = c(2, 3)) # Configurar para mostrar múltiples gráficos
numeric_columns <- c('age', 'fnlwgt', 'education_num', 'capital_gain', 'capital_loss', 'hours_per_week')
labels <- c('Age', 'Fnlwgt', 'Education Num', 'Capital Gain', 'Capital Loss', 'Hours per Week')
for (i in 1:length(numeric_columns)) {
  boxplot(adult_data[[numeric_columns[i]]], main = paste('Boxplot de', labels[i]), ylab = labels[i])
}
par(mfrow = c(1, 1)) # Restablecer la configuración

# Mostrar el número de filas eliminadas
deleted_rows <- initial_rows - nrow(adult_data)
cat("Número de filas eliminadas debido a valores extremos:", deleted_rows, "\n")

```

```{r}
# Identificar filas duplicadas
duplicated_rows <- nrow(adult_data) - nrow(adult_data %>% distinct())
cat("Número de filas duplicadas detectadas:", duplicated_rows, "\n")

# Eliminar filas duplicadas
adult_data <- adult_data %>% distinct()

# Validar la limpieza
dim(adult_data)
summary(adult_data)
```

```{r}
# --- 4. Método Supervisado: Árbol de Decisión ---
set.seed(123)
train_index <- createDataPartition(adult_data$income, p = 0.7, list = FALSE)
train_data <- adult_data[train_index, ]
test_data <- adult_data[-train_index, ]

# Entrenar el modelo
income_model <- rpart(income ~ age + workclass + education + marital_status + occupation + relationship + race + sex + capital_gain + capital_loss + hours_per_week + native_country,
                      data = train_data, method = "class")

# Evaluar el modelo
predictions <- predict(income_model, test_data, type = "class")
conf_matrix <- confusionMatrix(predictions, test_data$income)
print(conf_matrix)

# Calcular precisión
accuracy <- sum(diag(conf_matrix$table)) / sum(conf_matrix$table)
cat("Precisión del modelo:", accuracy, "\n")

```

```{r}
install.packages("rpart.plot")
library(rpart.plot)

rpart.plot(income_model)
```

```{r}
# Instalar y cargar los paquetes necesarios
install.packages("dummy")
install.packages("cluster")
install.packages("ggplot2")
library(cluster)
library(ggplot2)
library(dummy)
```

```{r}
install.packages("fastDummies")
library(fastDummies)
```

```{r}
# Codificar las variables categóricas usando fastDummies
adult_data_encoded <- dummy_cols(adult_data, select_columns = c('workclass', 'education', 'marital_status', 'occupation', 'relationship', 'race', 'sex', 'native_country'), remove_first_dummy = TRUE, remove_selected_columns = TRUE)

# Seleccionar todas las columnas numéricas y codificadas para el clustering
numeric_columns <- c('age', 'fnlwgt', 'education_num', 'capital_gain', 'capital_loss', 'hours_per_week')
dummy_columns <- grep("_", colnames(adult_data_encoded), value = TRUE)
all_columns <- c(numeric_columns, dummy_columns)
adult_data_numeric <- adult_data_encoded[, all_columns]

# Verificar que todas las columnas sean numéricas
str(adult_data_numeric)

# Normalizar los datos
adult_data_scaled <- scale(adult_data_numeric)

# Aplicar K-means clustering
set.seed(123)  # Fijar semilla para reproducibilidad
kmeans_result <- kmeans(adult_data_scaled, centers = 3, nstart = 20)

# Agregar el resultado del clustering al DataFrame original
adult_data$cluster <- as.factor(kmeans_result$cluster)

# Ver los centros de los clusters
print(kmeans_result$centers)

# Ver la cantidad de observaciones en cada cluster
table(adult_data$cluster)

# Crear un gráfico de dispersión de dos variables, coloreado por cluster
ggplot(adult_data, aes(x = age, y = hours_per_week, color = cluster)) +
  geom_point(alpha = 0.5) +
  labs(title = "Clustering K-means de Adult Data", x = "Edad", y = "Horas por Semana")
```
